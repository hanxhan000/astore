# A股动态分析与决策支持 Web 系统 — 功能文档（补充）

## 目标与原则
- 目标：面向个人客户，提供从注册登录、账户金额录入、自选股管理、资产分配到实时决策建议的完整闭环。
- 原则：所有业务数据（用户账户、持仓/自选股、分配与建议、日志）存储在云端；前端版本更新不得覆盖或篡改云端生产数据。

## 初次登录与账号体系
- 注册：邮箱/手机号注册，支持验证码；昵称与地区（可选）。
- 登录：凭账号密码；支持后续接入多因素认证（可选）。
- 忘记密码：通过邮箱/短信重置。
- 会话：前端仅保存短期令牌（如 JWT），严格过期控制；敏感信息不落地浏览器持久存储。

## 首次登录业务引导
- 引导流程：
  - 步骤1：输入账户总金额与基础货币（如 CNY）。
  - 步骤2：选择/导入自选股（手动输入或从 CSV/文本导入）。
  - 步骤3：设置风险偏好（保守/稳健/积极）与最大单标的权重上限。
  - 步骤4：保存配置并生成首版资产分配建议。

## 自选股与资产分配
- 自选股管理：新增/删除/标注备注；支持分组（如行业/主题）。
- 资产分配策略：
  - 资金管理：半仓持股法作为底层约束（保留 50% 现金，动态再平衡）。
  - 仓位优化：参考凯利公式思想，根据胜率/赔率（由行情与估值信号估算）动态调整具体投入比例。
  - 时机过滤：趋势信号（如月线 MACD 金叉、站上关键均线）触发分配或调仓。
  - 约束：单标的权重上限、行业集中度上限、买卖最小单位与滑点假设。
- 输出：
  - 建议分配表（标的→权重与金额）。
  - 操作建议（买入/卖出/调仓/观望），附理由与信号来源（技术/基本面）。

## 实时数据与决策建议
- 数据源：云端行情接口（如 AKShare 拉取后入库/缓存），提供近实时快照与历史 K 线。
- 指标计算：云端或前端计算 MA/MACD/RSI/布林带等；规模较大的计算在云端，前端进行增量与可视化。
- 决策逻辑：
  - 技术面：均线金叉/死叉、MACD 背离、突破/回踩等。
  - 基本面：估值区间（PE/PB/PS 与历史分位）、财务质量（ROE/利润增速）。
  - 风险：波动率与回撤监控，异常事件提示（公告、停牌、黑天鹅）。
- 呈现：看板概览、个股详情、建议 Feed；支持“模拟执行”与“记录实际执行”。

## 数据存储（云端）与模型
- 建议采用托管后端（示例：Supabase / Firebase / 自建 Serverless）。
- 核心数据模型（示例）：
  - users：用户基础信息（由云端认证系统管理）。
  - profiles：用户扩展字段（昵称、地区、偏好）。
  - accounts：账户资金与基础货币、风险偏好、阈值等。
  - watchlists：自选股分组；watchlist_items：自选股明细。
  - allocations：每次建议的资产分配记录（JSON 映射：symbol→weight/amount）。
  - signals：策略信号快照（symbol、类型、强度、时间、来源）。
  - actions：建议与用户执行记录（买/卖/调仓、数量/金额、价格、原因）。
  - market_cache：云端缓存的行情与指标快照（供前端读取）。
- 安全策略：
  - 行级安全（RLS）：用户仅可访问自己的数据；管理员需分离权限。
  - 密钥管理：前端使用公开可用的匿名读策略仅限行情快照；写入需用户会话令牌。

## 版本与部署策略（不更新云端生产数据）
- 前端版本发布：
  - CI/CD 仅构建与部署静态前端，不执行数据库迁移与数据写入任务。
  - 禁止在构建阶段执行任何“数据种子”或“初始化写入”脚本。
- 后端与数据库：
  - 迁移与变更由独立管道与审批执行；生产库备份后再迁移；回滚预案到位。
  - 区分环境（dev/staging/prod）；前端指向 `prod` 只读接口，不包含写入默认行为。
- 访问控制：
  - 生产数据写入需用户登录态与严格 API 权限；
  - 发布更新不触发任何对 `accounts/watchlists/allocations/actions` 的写操作。

## 前端页面与交互（补充）
- 认证页：注册/登录/忘记密码。
- 首次登录引导：账户金额、基础货币、风险偏好设置、自选股导入。
- 看板：账户资金分布、收益/回撤快照、预警卡片、热点与指数。
- 自选股页：分组管理、批量导入、标注备注。
- 详情页：K 线与指标、信号与建议、执行记录、估值分位与财务摘要。
- 建议页：按时间展示系统建议与执行状态；支持“模拟执行”。

## 通知与预警（可选）
- 条件：到价、涨跌幅阈值、信号触发（如金叉/破位）。
- 渠道：站内通知、邮件（需服务端支持）。

## 合规与风险提示
- 显示风险声明：不构成投资建议，盈亏自负。
- 数据来源标注与使用条款遵守；隐私与合规（如个人信息保护）。

## 路线图
- MVP：认证与首次引导、云端存储、自选股与分配建议、基础看板与详情页。
- 迭代：策略回测、智能预警、估值面与财务面扩展、多账户支持、更多数据源整合。